{% extends "custom_moderation/base.html" %}
{% block title %}Dashboard{% endblock %}

{% block extrastyle %}
<style>
    :root {
        --primary-color: #4e73df;
        --primary-dark: #2e59d9;
        --primary-light: #eaecf4;
        --success-color: #1cc88a;
        --info-color: #36b9cc;
        --warning-color: #f6c23e;
        --danger-color: #e74a3b;
        --secondary-color: #858796;
        --light-color: #f8f9fc;
        --dark-color: #5a5c69;
        --border-color: #e3e6f0;
    }
    
    /* Progress bars */
    .progress {
        height: 8px;
        background-color: var(--border-color);
        border-radius: 0.25rem;
        overflow: hidden;
        margin-top: 0.5rem;
    }
    
    .progress-bar {
        height: 100%;
    }
    
    .progress-bar-primary {
        background-color: var(--primary-color);
    }
    
    .progress-bar-success {
        background-color: var(--success-color);
    }
    
    .progress-primary-85 {
        width: 85%;
    }
    
    .progress-primary-90 {
        width: 90%;
    }
    
    .progress-primary-95 {
        width: 95%;
    }
    
    .progress-success-90 {
        width: 90%;
    }
    
    .progress-success-95 {
        width: 95%;
    }
    
    .progress-success-98 {
        width: 98%;
    }

    /* Dashboard components */
    .dashboard-card {
        border-radius: 0.75rem;
        background-color: #fff;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        margin-bottom: 1.5rem;
    }
    
    .dashboard-card-header {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .dashboard-card-body {
        padding: 1.25rem;
    }
    
    .dashboard-card-footer {
        border-top: 1px solid var(--border-color);
        background-color: var(--light-color);
        padding: 1rem;
    }
    
    .dashboard-card-title {
        font-weight: 700;
        font-size: 1rem;
        color: var(--dark-color);
        margin: 0;
    }
    
    /* Moderation status */
    .moderation-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .status-dropdown {
        position: relative;
    }
    
    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border-radius: 10rem;
        font-size: 0.75rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.15s ease-in-out;
    }
    
    .status-badge i {
        margin-right: 0.5rem;
        font-size: 0.625rem;
    }
    
    .status-active {
        background-color: rgba(28, 200, 138, 0.1);
        color: var(--success-color);
    }
    
    .status-busy {
        background-color: rgba(246, 194, 62, 0.1);
        color: var(--warning-color);
    }
    
    .status-offline {
        background-color: rgba(231, 74, 59, 0.1);
        color: var(--danger-color);
    }
    
    /* Stats cards */
    .stat-card {
        background-color: #fff;
        border-radius: 0.75rem;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        overflow: hidden;
        height: 100%;
        transition: transform 0.2s ease-in-out;
    }
    
    .stat-card:hover {
        transform: translateY(-0.25rem);
    }
    
    .stat-header {
        padding: 1.25rem 1.25rem 0;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
    }
    
    .stat-icon {
        width: 3rem;
        height: 3rem;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #fff;
    }
    
    .stat-title {
        margin: 0;
        font-weight: 700;
        font-size: 0.875rem;
        color: var(--secondary-color);
        text-transform: uppercase;
    }
    
    .stat-body {
        padding: 0 1.25rem 1.25rem;
    }
    
    .stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 0.25rem;
    }
    
    .stat-meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: var(--secondary-color);
        font-size: 0.875rem;
    }
    
    .stat-change {
        display: flex;
        align-items: center;
        font-weight: 700;
    }
    
    .stat-change i {
        margin-right: 0.25rem;
    }
    
    .stat-change.positive {
        color: var(--success-color);
    }
    
    .stat-change.negative {
        color: var(--danger-color);
    }
    
    /* Tabs */
    .tabs-container {
        background-color: #fff;
        border-radius: 0.75rem;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        overflow: hidden;
    }
    
    .tabs-header {
        display: flex;
        background-color: var(--light-color);
        border-bottom: 1px solid var(--border-color);
    }
    
    .tab {
        padding: 0.75rem 1.25rem;
        font-weight: 700;
        color: var(--secondary-color);
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }
    
    .tab:hover {
        color: var(--primary-color);
    }
    
    .tab.active {
        color: var(--primary-color);
    }
    
    .tab.active::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        bottom: -1px;
        height: 3px;
        background-color: var(--primary-color);
    }
    
    .tab-content {
        padding: 1.25rem;
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    /* Queue item */
    .queue-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        border-radius: 0.5rem;
        background-color: #fff;
        margin-bottom: 1rem;
        transition: all 0.2s;
        border: 1px solid var(--border-color);
    }
    
    .queue-item:hover {
        box-shadow: 0 0.15rem 1rem 0 rgba(58, 59, 69, 0.1);
        transform: translateY(-2px);
    }
    
    .queue-item:last-child {
        margin-bottom: 0;
    }
    
    .queue-item-icon {
        width: 3rem;
        height: 3rem;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        flex-shrink: 0;
    }
    
    .queue-item-icon.pda {
        background-color: rgba(78, 115, 223, 0.1);
        color: var(--primary-color);
    }
    
    .queue-item-icon.forum {
        background-color: rgba(54, 185, 204, 0.1);
        color: var(--info-color);
    }
    
    .queue-item-icon.reported {
        background-color: rgba(231, 74, 59, 0.1);
        color: var(--danger-color);
    }
    
    .queue-item-content {
        flex: 1;
        min-width: 0;
    }
    
    .queue-item-title {
        font-weight: 700;
        margin-bottom: 0.25rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .queue-item-meta {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.75rem;
        color: var(--secondary-color);
        font-size: 0.75rem;
    }
    
    .queue-item-meta span {
        display: flex;
        align-items: center;
    }
    
    .queue-item-meta i {
        margin-right: 0.35rem;
    }
    
    .queue-item-actions {
        margin-left: 1rem;
    }
    
    /* Activity timeline */
    .timeline {
        position: relative;
        padding: 1.25rem;
    }
    
    .timeline-item {
        position: relative;
        padding-left: 2.5rem;
        padding-bottom: 1.5rem;
    }
    
    .timeline-item:last-child {
        padding-bottom: 0;
    }
    
    .timeline-item:not(:last-child)::after {
        content: "";
        position: absolute;
        left: 1rem;
        top: 2rem;
        bottom: 0;
        width: 2px;
        background-color: var(--border-color);
    }
    
    .timeline-icon {
        position: absolute;
        left: 0;
        top: 0;
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1;
    }
    
    .timeline-icon.primary {
        background-color: rgba(78, 115, 223, 0.1);
        color: var(--primary-color);
    }
    
    .timeline-icon.success {
        background-color: rgba(28, 200, 138, 0.1);
        color: var(--success-color);
    }
    
    .timeline-icon.warning {
        background-color: rgba(246, 194, 62, 0.1);
        color: var(--warning-color);
    }
    
    .timeline-icon.danger {
        background-color: rgba(231, 74, 59, 0.1);
        color: var(--danger-color);
    }
    
    .timeline-icon.info {
        background-color: rgba(54, 185, 204, 0.1);
        color: var(--info-color);
    }
    
    .timeline-content {
        background-color: #fff;
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid var(--border-color);
    }
    
    .timeline-title {
        font-weight: 700;
        margin-bottom: 0.25rem;
    }
    
    .timeline-time {
        color: var(--secondary-color);
        font-size: 0.75rem;
        margin-bottom: 0.5rem;
    }
    
    .timeline-description {
        color: var(--dark-color);
        font-size: 0.875rem;
        margin-bottom: 0;
    }
    
    /* Profile card */
    .profile-card {
        background-color: #fff;
        border-radius: 0.75rem;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        overflow: hidden;
    }
    
    .profile-header {
        background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
        padding: 2rem 1.25rem;
        color: #fff;
        text-align: center;
    }
    
    .profile-avatar {
        width: 6rem;
        height: 6rem;
        border-radius: 50%;
        background-color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        border: 4px solid rgba(255, 255, 255, 0.2);
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
    }
    
    .profile-name {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }
    
    .profile-role {
        opacity: 0.9;
        font-size: 0.875rem;
    }
    
    .profile-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        padding: 1.25rem;
    }
    
    .profile-stat {
        text-align: center;
    }
    
    .profile-stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 0.25rem;
    }
    
    .profile-stat-label {
        font-size: 0.75rem;
        color: var(--secondary-color);
    }
    
    .progress {
        height: 8px;
        background-color: var(--border-color);
        border-radius: 0.25rem;
        overflow: hidden;
        margin-top: 0.5rem;
    }
    
    .progress-bar {
        height: 100%;
    }
    
    /* Badge */
    .badge {
        display: inline-flex;
        align-items: center;
        padding: 0.35rem 0.65rem;
        border-radius: 10rem;
        font-size: 0.75rem;
        font-weight: 700;
    }
    
    .badge-primary {
        background-color: rgba(78, 115, 223, 0.1);
        color: var(--primary-color);
    }
    
    .badge-success {
        background-color: rgba(28, 200, 138, 0.1);
        color: var(--success-color);
    }
    
    .badge-info {
        background-color: rgba(54, 185, 204, 0.1);
        color: var(--info-color);
    }
    
    .badge-warning {
        background-color: rgba(246, 194, 62, 0.1);
        color: var(--warning-color);
    }
    
    .badge-danger {
        background-color: rgba(231, 74, 59, 0.1);
        color: var(--danger-color);
    }
    
    .badge i {
        margin-right: 0.25rem;
    }
    
    /* Empty state */
    .empty-state {
        padding: 3rem 1.5rem;
        text-align: center;
    }
    
    .empty-state-icon {
        font-size: 3rem;
        color: var(--border-color);
        margin-bottom: 1rem;
    }
    
    .empty-state-title {
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .empty-state-text {
        color: var(--secondary-color);
        max-width: 400px;
        margin: 0 auto;
    }
    
    /* Chart container */
    .chart-container {
        position: relative;
        height: 280px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="dashboard-card mb-4">
    <div class="dashboard-card-body">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="h3 mb-0 font-weight-bold">Moderation Dashboard</h1>
                <p class="text-muted mb-0">Welcome back, {{ request.user.username }}! Here's your activity overview.</p>
            </div>
            <div class="col-md-6">
                <div class="d-flex justify-content-md-end mt-3 mt-md-0">
                    <div class="dropdown me-3">
                        <button class="status-badge status-active dropdown-toggle" id="statusDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-circle"></i> Available for Moderation
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="statusDropdown">
                            <li><a class="dropdown-item" href="#" data-status="active"><i class="fas fa-circle text-success"></i> Available for Moderation</a></li>
                            <li><a class="dropdown-item" href="#" data-status="busy"><i class="fas fa-circle text-warning"></i> Busy</a></li>
                            <li><a class="dropdown-item" href="#" data-status="offline"><i class="fas fa-circle text-danger"></i> Offline</a></li>
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" id="dashboardActions" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dashboardActions">
                            <li><a class="dropdown-item" href="{% url 'admin:index' %}"><i class="fas fa-tools me-2"></i>Admin Panel</a></li>
                            <li><a class="dropdown-item" href="{% url 'pda_moderation' %}"><i class="fas fa-photo-video me-2"></i>Review Submissions</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-comments me-2"></i>Moderate Forum</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="generateReport"><i class="fas fa-download me-2"></i>Generate Report</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Stats Overview -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">PENDING QUEUE</div>
                <div class="stat-icon bg-primary">
                    <i class="fas fa-tasks"></i>
                </div>
            </div>
            <div class="stat-body">
                <div class="stat-value">{{ pending_count|default:"23" }}</div>
                <div class="stat-meta">
                    <span>Items requiring review</span>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> 5%
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">PDA SUBMISSIONS</div>
                <div class="stat-icon bg-info">
                    <i class="fas fa-photo-video"></i>
                </div>
            </div>
            <div class="stat-body">
                <div class="stat-value">{{ pda_count|default:"48" }}</div>
                <div class="stat-meta">
                    <span>Total submissions</span>
                    <span class="stat-change positive">
                        <i class="fas fa-check"></i> {{ approved_pda_count|default:"39" }}
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">FORUM ACTIVITY</div>
                <div class="stat-icon bg-success">
                    <i class="fas fa-comments"></i>
                </div>
            </div>
            <div class="stat-body">
                <div class="stat-value">{{ forum_count|default:"105" }}</div>
                <div class="stat-meta">
                    <span>Posts this week</span>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> {{ forum_percent_change|default:"12" }}%
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">REPORTED CONTENT</div>
                <div class="stat-icon bg-danger">
                    <i class="fas fa-flag"></i>
                </div>
            </div>
            <div class="stat-body">
                <div class="stat-value">{{ reported_count|default:"8" }}</div>
                <div class="stat-meta">
                    <span>Content reported</span>
                    <span class="stat-change {% if reported_percent_change > 0 %}negative{% else %}positive{% endif %}">
                        <i class="fas fa-arrow-{% if reported_percent_change > 0 %}up{% else %}down{% endif %}"></i> 
                        {{ reported_percent_change|default:"15"|abs }}%
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Row -->
<div class="row">
    <!-- Left Column -->
    <div class="col-lg-8">
        <!-- Moderation Queue -->
        <div class="tabs-container mb-4">
            <div class="dashboard-card-header">
                <h5 class="dashboard-card-title">
                    <i class="fas fa-list me-2 text-primary"></i> Moderation Queue
                </h5>
                <a href="{% url 'pda_moderation' %}" class="btn btn-sm btn-primary">View All</a>
            </div>
            
            <div class="tabs-header">
                <div class="tab active" data-tab="all-items">All Items</div>
                <div class="tab" data-tab="pda-items">PDA Submissions</div>
                <div class="tab" data-tab="forum-items">Forum Content</div>
                <div class="tab" data-tab="reported-items">Reported</div>
            </div>
            
            <div class="tab-content active" id="all-items">
                {% if pending_items %}
                    {% for item in pending_items %}
                    <div class="queue-item">
                        <div class="queue-item-icon {{ item.type }}">
                            <i class="fas fa-{% if item.type == 'pda' %}photo-video{% elif item.type == 'forum' %}comments{% else %}flag{% endif %}"></i>
                        </div>
                        <div class="queue-item-content">
                            <h6 class="queue-item-title">{{ item.title }}</h6>
                            <div class="queue-item-meta">
                                <span><i class="fas fa-user"></i> {{ item.author }}</span>
                                <span><i class="fas fa-calendar"></i> {{ item.date }}</span>
                                <span><i class="fas fa-clock"></i> {{ item.time_ago }}</span>
                                <span class="badge badge-{% if item.type == 'pda' %}primary{% elif item.type == 'forum' %}info{% else %}danger{% endif %}">
                                    <i class="fas fa-tag"></i> {{ item.type|title }}
                                </span>
                            </div>
                        </div>
                        <div class="queue-item-actions">
                            <a href="{{ item.url }}" class="btn btn-sm btn-primary">Review</a>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-check-circle empty-state-icon text-success"></i>
                        <h5 class="empty-state-title">All Caught Up!</h5>
                        <p class="empty-state-text">There are no pending items requiring your review.</p>
                    </div>
                {% endif %}
            </div>
            
            <div class="tab-content" id="pda-items">
                <div class="empty-state">
                    <i class="fas fa-photo-video empty-state-icon text-primary"></i>
                    <h5 class="empty-state-title">No PDA Submissions</h5>
                    <p class="empty-state-text">There are currently no PDA submissions requiring review.</p>
                </div>
            </div>
            
            <div class="tab-content" id="forum-items">
                <div class="empty-state">
                    <i class="fas fa-comments empty-state-icon text-info"></i>
                    <h5 class="empty-state-title">No Forum Content</h5>
                    <p class="empty-state-text">There are currently no forum posts requiring moderation.</p>
                </div>
            </div>
            
            <div class="tab-content" id="reported-items">
                <div class="empty-state">
                    <i class="fas fa-flag empty-state-icon text-danger"></i>
                    <h5 class="empty-state-title">No Reported Content</h5>
                    <p class="empty-state-text">There are currently no reported items requiring review.</p>
                </div>
            </div>
            
            <div class="dashboard-card-footer d-flex justify-content-between align-items-center">
                <span class="text-muted small">Showing {{ pending_items|length|default:"0" }} of {{ pending_count|default:"0" }} items</span>
                {% if pending_count|default:0 > 5 %}
                <nav>
                    <ul class="pagination pagination-sm mb-0">
                        <li class="page-item disabled"><a class="page-link" href="#">Prev</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">Next</a></li>
                    </ul>
                </nav>
                {% endif %}
            </div>
        </div>
        
        <!-- Activity Chart -->
        <div class="dashboard-card">
            <div class="dashboard-card-header">
                <h5 class="dashboard-card-title">
                    <i class="fas fa-chart-line me-2 text-primary"></i> Moderation Activity
                </h5>
                <div class="btn-group btn-group-sm">
                    <button type="button" class="btn btn-outline-secondary active" data-period="week">Week</button>
                    <button type="button" class="btn btn-outline-secondary" data-period="month">Month</button>
                    <button type="button" class="btn btn-outline-secondary" data-period="quarter">Quarter</button>
                </div>
            </div>
            <div class="dashboard-card-body">
                <div class="chart-container">
                    <canvas id="weeklyActivityChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Right Column -->
    <div class="col-lg-4">
        <!-- Moderator Profile -->
        <div class="profile-card mb-4">
            <div class="profile-header">
                <div class="profile-avatar">
                    {{ request.user.username.0|upper }}
                </div>
                <h4 class="profile-name">{{ request.user.username }}</h4>
                <div class="profile-role">{{ moderation_level|default:"Senior Moderator" }}</div>
            </div>
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value">{{ moderator_activity_percent|default:"85" }}%</div>
                    <div class="profile-stat-label">Activity</div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-primary progress-primary-85"></div>
                    </div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value">{{ moderator_accuracy|default:"98" }}%</div>
                    <div class="profile-stat-label">Accuracy</div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-success progress-success-98"></div>
                    </div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value">{{ average_response_time|default:"24" }}m</div>
                    <div class="profile-stat-label">Avg. Response</div>
                </div>
            </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="dashboard-card">
            <div class="dashboard-card-header">
                <h5 class="dashboard-card-title">
                    <i class="fas fa-history me-2 text-primary"></i> Recent Activity
                </h5>
                <button class="btn btn-sm btn-outline-secondary refresh-activity">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div class="dashboard-card-body p-0">
                <div class="timeline">
                    {% if recent_activity %}
                        {% for activity in recent_activity %}
                        <div class="timeline-item">
                            <div class="timeline-icon {% if activity.type == 'pda' %}primary{% elif activity.type == 'approved' %}success{% elif activity.type == 'rejected' %}danger{% else %}info{% endif %}">
                                <i class="fas fa-{% if activity.type == 'pda' %}photo-video{% elif activity.type == 'approved' %}check{% elif activity.type == 'rejected' %}ban{% else %}comment-alt{% endif %}"></i>
                            </div>
                            <div class="timeline-content">
                                <h6 class="timeline-title">{{ activity.title }}</h6>
                                <div class="timeline-time">{{ activity.time }}</div>
                                <p class="timeline-description">{{ activity.description }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-history empty-state-icon"></i>
                            <h5 class="empty-state-title">No Recent Activity</h5>
                            <p class="empty-state-text">Your recent moderation activities will appear here.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="dashboard-card-footer text-center">
                <a href="#" class="btn btn-sm btn-outline-primary">View All Activity</a>
            </div>
        </div>
    </div>
</div>

<!-- Status Breakdown -->
<div class="dashboard-card mt-2">
    <div class="dashboard-card-header">
        <h5 class="dashboard-card-title">
            <i class="fas fa-chart-pie me-2 text-primary"></i> Content Status Breakdown
        </h5>
        <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-outline-secondary active" data-timeframe="week">Last 7 Days</button>
            <button type="button" class="btn btn-outline-secondary" data-timeframe="month">Last 30 Days</button>
            <button type="button" class="btn btn-outline-secondary" data-timeframe="all">All Time</button>
        </div>
    </div>
    <div class="dashboard-card-body">
        <div class="row">
            <div class="col-md-4">
                <div class="chart-container">
                    <canvas id="statusBreakdownChart"></canvas>
                </div>
            </div>
            <div class="col-md-8">
                <div class="row h-100 align-items-center">
                    <div class="col-sm-4 text-center">
                        <div class="p-3">
                            <h3 class="text-success mb-2">{{ approved_count|default:"65" }}%</h3>
                            <p class="mb-1">Approved</p>
                            <div class="d-flex justify-content-center align-items-center">
                                <span class="badge badge-success me-2">
                                    <i class="fas fa-check"></i>
                                </span>
                                <span class="text-muted small">Content published</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 text-center">
                        <div class="p-3">
                            <h3 class="text-danger mb-2">{{ rejected_count|default:"15" }}%</h3>
                            <p class="mb-1">Rejected</p>
                            <div class="d-flex justify-content-center align-items-center">
                                <span class="badge badge-danger me-2">
                                    <i class="fas fa-ban"></i>
                                </span>
                                <span class="text-muted small">Content filtered</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 text-center">
                        <div class="p-3">
                            <h3 class="text-warning mb-2">{{ pending_percent|default:"20" }}%</h3>
                            <p class="mb-1">Pending</p>
                            <div class="d-flex justify-content-center align-items-center">
                                <span class="badge badge-warning me-2">
                                    <i class="fas fa-clock"></i>
                                </span>
                                <span class="text-muted small">Awaiting decision</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Status dropdown functionality
    const statusBadge = document.querySelector('.status-badge');
    const statusOptions = document.querySelectorAll('.dropdown-item[data-status]');
    
    statusOptions.forEach(option => {
        option.addEventListener('click', function(e) {
            e.preventDefault();
            const status = this.getAttribute('data-status');
            const statusText = this.textContent.trim();
            
            // Remove previous status classes
            statusBadge.classList.remove('status-active', 'status-busy', 'status-offline');
            
            // Add new status class
            statusBadge.classList.add(`status-${status}`);
            
            // Update text
            statusBadge.innerHTML = `<i class="fas fa-circle"></i> ${statusText}`;
            
            // Show notification (if toastr is available)
            if (typeof toastr !== 'undefined') {
                toastr.success(`Status updated to "${statusText}"`);
            }
        });
    });
    
    // Tab functionality
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Remove active class from all tabs
            tabs.forEach(t => t.classList.remove('active'));
            
            // Add active class to clicked tab
            this.classList.add('active');
            
            // Hide all tab contents
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Show the corresponding tab content
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Activity chart period buttons
    const periodButtons = document.querySelectorAll('.btn-group [data-period]');
    
    periodButtons.forEach(button => {
        button.addEventListener('click', function() {
            periodButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // We would update the chart data here in a real application
            // For the demo, we can just show a notification
            if (typeof toastr !== 'undefined') {
                toastr.info(`Viewing ${this.textContent} data`);
            }
        });
    });
    
    // Timeframe buttons
    const timeframeButtons = document.querySelectorAll('.btn-group [data-timeframe]');
    
    timeframeButtons.forEach(button => {
        button.addEventListener('click', function() {
            timeframeButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // We would update the chart data here in a real application
            if (typeof toastr !== 'undefined') {
                toastr.info(`Viewing ${this.textContent} data`);
            }
        });
    });
    
    // Refresh activity button
    const refreshButton = document.querySelector('.refresh-activity');
    
    if (refreshButton) {
        refreshButton.addEventListener('click', function() {
            const icon = this.querySelector('i');
            icon.classList.add('fa-spin');
            
            // Simulate refreshing data
            setTimeout(() => {
                icon.classList.remove('fa-spin');
                if (typeof toastr !== 'undefined') {
                    toastr.success('Activity feed refreshed');
                }
            }, 1000);
        });
    }
    
    // Generate report button
    const generateReportBtn = document.getElementById('generateReport');
    
    if (generateReportBtn) {
        generateReportBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Show loading state
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';
            
            // Simulate report generation
            setTimeout(() => {
                this.innerHTML = originalText;
                if (typeof toastr !== 'undefined') {
                    toastr.success('Report generated successfully');
                }
            }, 2000);
        });
    }
    
    // Weekly Activity Chart
    const weeklyActivityChart = new Chart(
        document.getElementById('weeklyActivityChart').getContext('2d'),
        {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [
                    {
                        label: 'PDA Submissions',
                        data: [5, 8, 12, 6, 9, 3, 7],
                        borderColor: '#4e73df',
                        backgroundColor: 'rgba(78, 115, 223, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#4e73df',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'Forum Content',
                        data: [12, 9, 15, 8, 10, 5, 7],
                        borderColor: '#36b9cc',
                        backgroundColor: 'rgba(54, 185, 204, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#36b9cc',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'Reported Items',
                        data: [3, 4, 6, 2, 5, 1, 2],
                        borderColor: '#e74a3b',
                        backgroundColor: 'rgba(231, 74, 59, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#e74a3b',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        fill: true,
                        tension: 0.3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: '#2d3748',
                        padding: 12,
                        cornerRadius: 8,
                        titleFont: {
                            size: 14
                        },
                        bodyFont: {
                            size: 13
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            borderDash: [2, 4],
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            font: {
                                size: 12
                            },
                            precision: 0
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index',
                }
            }
        }
    );
    
    // Status Breakdown Chart
    const statusBreakdownChart = new Chart(
        document.getElementById('statusBreakdownChart').getContext('2d'),
        {
            type: 'doughnut',
            data: {
                labels: ['Approved', 'Rejected', 'Pending'],
                datasets: [{
                    data: [65, 15, 20],
                    backgroundColor: ['#1cc88a', '#e74a3b', '#f6c23e'],
                    borderWidth: 0,
                    hoverOffset: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#2d3748',
                        padding: 12,
                        cornerRadius: 8,
                        titleFont: {
                            size: 14
                        },
                        bodyFont: {
                            size: 13
                        },
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${percentage}%`;
                            }
                        }
                    }
                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        }
    );
});
</script>
{% endblock %} 