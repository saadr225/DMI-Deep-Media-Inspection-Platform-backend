{% extends "moderation/base.html" %}
{% block title %}Moderation Dashboard{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card primary">
        <i class="fas fa-folder fa-2x"></i>
        <div class="label">Pending PDA Submissions</div>
        <div class="value">{{ pda_pending_count }}</div>
        <a href="{% url 'pda_moderation' %}" class="btn btn-primary btn-sm mt-2">Review</a>
    </div>
    <div class="stat-card info">
        <i class="fas fa-comments fa-2x"></i>
        <div class="label">Pending Forum Threads</div>
        <div class="value">{{ forum_pending_count }}</div>
        <a href="{% url 'forum_moderation' %}" class="btn btn-info btn-sm mt-2">Review</a>
    </div>
    <div class="stat-card warning">
        <i class="fas fa-flag fa-2x"></i>
        <div class="label">Reported Content</div>
        <div class="value">{{ reported_count|default:"0" }}</div>
        <a href="{% url 'forum_moderation' %}?filter=reported" class="btn btn-warning btn-sm mt-2">Review</a>
    </div>
    <div class="stat-card success">
        <i class="fas fa-users fa-2x"></i>
        <div class="label">Total Users</div>
        <div class="value">{{ user_count }}</div>
        {% if request.is_admin %}
        <a href="{% url 'user_management' %}" class="btn btn-success btn-sm mt-2">Manage</a>
        {% endif %}
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="m-0 font-weight-bold">Recent PDA Submissions</h5>
                <a href="{% url 'pda_moderation' %}" class="btn btn-primary btn-sm">View All</a>
            </div>
            <div class="card-body">
                {% if recent_pda_submissions %}
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for submission in recent_pda_submissions %}
                            <tr>
                                <td>{{ submission.title }}</td>
                                <td>{{ submission.category }}</td>
                                <td>{{ submission.submission_date|date:"M d, Y" }}</td>
                                <td>
                                    {% if submission.is_approved %}
                                    <span class="badge bg-success">Approved</span>
                                    {% elif submission.review_date %}
                                    <span class="badge bg-danger">Rejected</span>
                                    {% else %}
                                    <span class="badge bg-warning">Pending</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-center">No recent submissions found.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="m-0 font-weight-bold">Recent Forum Activity</h5>
                <a href="{% url 'forum_moderation' %}" class="btn btn-primary btn-sm">View All</a>
            </div>
            <div class="card-body">
                {% if recent_forum_threads %}
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Author</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for thread in recent_forum_threads %}
                            <tr>
                                <td>{{ thread.title }}</td>
                                <td>{{ thread.author.user.username }}</td>
                                <td>{{ thread.created_at|date:"M d, Y" }}</td>
                                <td>
                                    {% if thread.approval_status == 'approved' %}
                                    <span class="badge bg-success">Approved</span>
                                    {% elif thread.approval_status == 'rejected' %}
                                    <span class="badge bg-danger">Rejected</span>
                                    {% else %}
                                    <span class="badge bg-warning">Pending</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-center">No recent forum activity found.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if request.is_admin %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="m-0 font-weight-bold">Moderator Activity</h5>
                <a href="{% url 'analytics_dashboard' %}" class="btn btn-primary btn-sm">View Analytics</a>
            </div>
            <div class="card-body">
                {% if moderator_actions %}
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Moderator</th>
                                <th>Action</th>
                                <th>Content</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for action in moderator_actions %}
                            <tr>
                                <td>{{ action.moderator.username }}</td>
                                <td>{{ action.action_type }}</td>
                                <td>{{ action.content_type }}</td>
                                <td>{{ action.timestamp|date:"M d, Y H:i" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-center">No recent moderator activity found.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}
