{% extends "moderation/base.html" %} {% block title %}PDA Submissions Moderation{% endblock %} {% block page_title %}PDA Submissions
Moderation{% endblock %} {% block header_actions %}
<div class="button-group">
  <button id="refreshQueue" class="btn btn-secondary"><i class="fas fa-sync-alt"></i> Refresh Queue</button>
  <div class="filter-dropdown">
    <button class="btn btn-primary dropdown-toggle"><i class="fas fa-filter"></i> Filter</button>
    <div class="dropdown-menu">
      <a href="?status=pending" class="dropdown-item {% if status == 'pending' %}active{% endif %}">Pending</a>
      <a href="?status=approved" class="dropdown-item {% if status == 'approved' %}active{% endif %}">Approved</a>
      <a href="?status=rejected" class="dropdown-item {% if status == 'rejected' %}active{% endif %}">Rejected</a>
      <a href="?status=all" class="dropdown-item {% if status == 'all' %}active{% endif %}">All</a>
    </div>
  </div>
</div>
{% endblock %} {% block content %}
<div class="stats-grid">
  <div class="stat-card">
    <div class="label">Pending Submissions</div>
    <div class="value">{{ pending_count }}</div>
  </div>
  <div class="stat-card">
    <div class="label">Total Submissions</div>
    <div class="value">{{ total_count }}</div>
  </div>
  <div class="stat-card">
    <div class="label">Approval Rate</div>
    <div class="value">{{ approval_rate }}%</div>
  </div>
</div>

{% if message %}
<div class="alert alert-{{ message_type }}">{{ message }}</div>
{% endif %}

<div class="card">
  <div class="card-header">
    <h3>PDA Submissions {% if status != 'all' %}({{ status|title }}){% endif %}</h3>
  </div>
  <div class="card-body">
    {% if submissions %}
    <div class="submissions-list">
      {% for submission in submissions %}
      <div class="submission-card">
        <div class="submission-header">
          <h4 class="submission-title">{{ submission.title }}</h4>
          <div class="submission-meta">
            <span class="submission-date">Submitted: {{ submission.submission_date|date:"M d, Y H:i" }}</span>
            <span class="submission-status">
              {% if submission.review_date %} {% if submission.is_approved %}
              <span class="badge bg-success">Approved</span>
              {% else %}
              <span class="badge bg-danger">Rejected</span>
              {% endif %} {% else %}
              <span class="badge bg-warning">Pending</span>
              {% endif %}
            </span>
          </div>
        </div>

        <div class="submission-content">
          <div class="submission-details">
            <div class="submission-field">
              <div class="field-label">Submitter:</div>
              <div class="field-value">{{ submission.user.username }}</div>
            </div>
            <div class="submission-field">
              <div class="field-label">Image Type:</div>
              <div class="field-value">{{ submission.image_type }}</div>
            </div>
            <div class="submission-field">
              <div class="field-label">Description:</div>
              <div class="field-value">{{ submission.description|linebreaks }}</div>
            </div>
          </div>

          <div class="submission-preview">
            {% if submission.image_url %}
            <img src="{{ submission.image_url }}" alt="{{ submission.title }}" class="preview-image" />
            {% endif %}
          </div>
        </div>

        {% if not submission.review_date %}
        <div class="submission-actions">
          <form method="post">
            {% csrf_token %}
            <input type="hidden" name="submission_id" value="{{ submission.id }}" />
            <div class="form-group">
              <label for="feedback-{{ submission.id }}">Feedback (optional):</label>
              <textarea
                class="form-control"
                id="feedback-{{ submission.id }}"
                name="feedback"
                rows="3"
                placeholder="Enter feedback for the user..."
              ></textarea>
            </div>
            <div class="button-group">
              <button type="submit" name="action" value="approve" class="btn btn-success">
                <i class="fas fa-check"></i> Approve Submission
              </button>
              <button type="submit" name="action" value="reject" class="btn btn-danger">
                <i class="fas fa-times"></i> Reject Submission
              </button>
            </div>
          </form>
        </div>
        {% else %}
        <div class="submission-review">
          <div class="review-info">
            <span class="review-date">Reviewed: {{ submission.review_date|date:"M d, Y H:i" }}</span>
            <span class="reviewer">by {{ submission.reviewer.username }}</span>
          </div>
          {% if submission.feedback %}
          <div class="review-feedback">
            <div class="field-label">Feedback:</div>
            <div class="field-value">{{ submission.feedback|linebreaks }}</div>
          </div>
          {% endif %}
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    {% if submissions.has_other_pages %}
    <div class="pagination">
      <ul>
        {% if submissions.has_previous %}
        <li><a href="?page={{ submissions.previous_page_number }}{% if status %}&status={{ status }}{% endif %}">&laquo; Previous</a></li>
        {% else %}
        <li><a class="disabled">&laquo; Previous</a></li>
        {% endif %} {% for i in submissions.paginator.page_range %} {% if submissions.number == i %}
        <li><a class="active">{{ i }}</a></li>
        {% else %}
        <li><a href="?page={{ i }}{% if status %}&status={{ status }}{% endif %}">{{ i }}</a></li>
        {% endif %} {% endfor %} {% if submissions.has_next %}
        <li><a href="?page={{ submissions.next_page_number }}{% if status %}&status={{ status }}{% endif %}">Next &raquo;</a></li>
        {% else %}
        <li><a class="disabled">Next &raquo;</a></li>
        {% endif %}
      </ul>
    </div>
    {% endif %} {% else %}
    <div class="empty-state">
      <div class="empty-state-icon">
        <i class="fas fa-file-image"></i>
      </div>
      <h3 class="empty-state-title">No submissions found</h3>
      <p>There are no PDA submissions {% if status != 'all' %}with status "{{ status }}"{% endif %} at this time.</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %} {% block extra_styles %}
<style>
  .submissions-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .submission-card {
    background-color: white;
    border-radius: 0.35rem;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
    overflow: hidden;
  }

  .submission-header {
    padding: 1.25rem;
    border-bottom: 1px solid var(--border-color);
    background-color: #f8f9fc;
  }

  .submission-title {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .submission-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-muted);
  }

  .submission-content {
    padding: 1.25rem;
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .submission-content {
      grid-template-columns: 1fr 1fr;
    }
  }

  .submission-details {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .submission-field {
    margin-bottom: 0.75rem;
  }

  .field-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 0.25rem;
  }

  .field-value {
    font-size: 0.9375rem;
  }

  .submission-preview {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
  }

  .preview-image {
    max-width: 100%;
    max-height: 300px;
    border-radius: 0.25rem;
    box-shadow: 0 0.125rem 0.25rem 0 rgba(58, 59, 69, 0.2);
  }

  .submission-actions {
    padding: 1.25rem;
    border-top: 1px solid var(--border-color);
    background-color: #f8f9fc;
  }

  .submission-review {
    padding: 1.25rem;
    border-top: 1px solid var(--border-color);
    background-color: #f8f9fc;
  }

  .review-info {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: 0.75rem;
    display: flex;
    justify-content: space-between;
  }

  .review-feedback {
    margin-top: 0.75rem;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .form-control {
    display: block;
    width: 100%;
    padding: 0.375rem 0.75rem;
    font-size: 0.9375rem;
    line-height: 1.5;
    color: var(--dark-color);
    background-color: white;
    background-clip: padding-box;
    border: 1px solid #d1d3e2;
    border-radius: 0.35rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    margin-bottom: 1rem;
  }

  .form-control:focus {
    color: var(--dark-color);
    background-color: white;
    border-color: #bac8f3;
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
  }

  .dropdown-toggle {
    position: relative;
    padding-right: 2rem;
  }

  .dropdown-toggle::after {
    content: "";
    display: inline-block;
    margin-left: 0.255em;
    vertical-align: 0.255em;
    border-top: 0.3em solid;
    border-right: 0.3em solid transparent;
    border-bottom: 0;
    border-left: 0.3em solid transparent;
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
  }

  .filter-dropdown {
    position: relative;
    display: inline-block;
  }

  .dropdown-menu {
    position: absolute;
    top: 100%;
    right: 0;
    z-index: 1000;
    display: none;
    min-width: 10rem;
    padding: 0.5rem 0;
    margin: 0.125rem 0 0;
    font-size: 0.875rem;
    color: var(--dark-color);
    text-align: left;
    list-style: none;
    background-color: white;
    background-clip: padding-box;
    border: 1px solid rgba(0, 0, 0, 0.15);
    border-radius: 0.35rem;
    box-shadow: 0 0.5rem 1rem 0 rgba(58, 59, 69, 0.175);
  }

  .filter-dropdown:hover .dropdown-menu {
    display: block;
  }

  .dropdown-item {
    display: block;
    width: 100%;
    padding: 0.25rem 1.5rem;
    clear: both;
    font-weight: 400;
    color: var(--dark-color);
    text-align: inherit;
    white-space: nowrap;
    background-color: transparent;
    border: 0;
    text-decoration: none;
  }

  .dropdown-item:hover,
  .dropdown-item:focus {
    color: var(--dark-color);
    text-decoration: none;
    background-color: #f8f9fc;
  }

  .dropdown-item.active,
  .dropdown-item:active {
    color: #fff;
    text-decoration: none;
    background-color: var(--primary-color);
  }

  .empty-state {
    text-align: center;
    padding: 3rem 1.5rem;
  }

  .empty-state-icon {
    font-size: 3rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
  }

  .empty-state-title {
    font-size: 1.5rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
  }

  .alert {
    padding: 0.75rem 1.25rem;
    margin-bottom: 1.5rem;
    border: 1px solid transparent;
    border-radius: 0.35rem;
  }

  .alert-success {
    color: #0f6848;
    background-color: #d1f0e8;
    border-color: #c0eadf;
  }

  .alert-danger {
    color: #78261f;
    background-color: #fadbd8;
    border-color: #f8ccc8;
  }
</style>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Refresh button
    document.getElementById("refreshQueue").addEventListener("click", function () {
      window.location.reload();
    });
  });
</script>
{% endblock %}
